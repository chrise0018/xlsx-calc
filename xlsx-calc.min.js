/*! xlsx-calc 2015-10-24 */
"use strict";(function(){function a(a,b,c){return a?b:c}function b(){for(var a="",b=0;b<arguments.length;b++)a+=arguments[b];return a}function c(){for(var a=0,b=arguments.length;b--;){var c=arguments[b];if(Array.isArray(c))for(var d=c,e=d.length;e--;)for(var f=d[e].length;f--;)a+=+d[e][f];else a+=+c}return a}function d(){for(var a=null,b=arguments.length;b--;){var c=arguments[b];if(Array.isArray(c))for(var d=c,e=d.length;e--;)a=null==a||a<d[e]?d[e]:a;else isNaN(c)?console.log("WTF??",c):a=null==a||c>a?c:a}return a}function e(){for(var a=null,b=arguments.length;b--;){var c=arguments[b];if(Array.isArray(c))for(var d=c,e=d.length;e--;)a=null==a||a>d[e]?d[e]:a;else isNaN(c)?console.log("WTF??",c):a=null==a||a>c?c:a}return a}function f(a,b,c){for(var d=0;d<b.length;d++)if(b[d][0]==a)return b[d][c-1];throw Error("#N/A")}function g(a){var b=this;b.name="UserFn",b.args=[],b.calc=function(){return a.apply(b,b.args)},b.push=function(a){b.args.push(a.calc())}}function h(a){this.calc=function(){return a}}function i(a,b){this.calc=function(){var c=b.sheet[a];if(!c)throw Error("Cell "+a+" not found.");var d=b.formula_ref[a];if(!d)return b.sheet[a].v;if("new"===d.status)return n(d),b.sheet[a].v;if("working"===d.status)throw new Error("Circular ref");return"done"===d.status?b.sheet[a].v:void 0}}function j(a){for(var b=0,c=a.replace(/[0-9]+$/,""),d=c.length;d--;)b+=Math.pow(26,c.length-d-1)*(c.charCodeAt(d)-64);return b-1}function k(a){for(var b="";a>25;)a-=26,b+="A";return b+String.fromCharCode(a+65)}function l(a,b){this.calc=this.values=function(){for(var c=a.split(":"),d=parseInt(c[0].replace(/^[A-Z]+/,""),10),e=parseInt(c[1].replace(/^[A-Z]+/,""),10),f=j(c[0]),g=j(c[1]),h=[],i=d;e>=i;i++){var l=[];h.push(l);for(var m=f;g>=m;m++){var o=k(m)+i;if(b.formula_ref[o]){if("new"===b.formula_ref[o].status)n(b.formula_ref[o]);else if("working"===b.formula_ref[o].status)throw new Error("Circular ref");l.push(b.sheet[o].v)}else b.sheet[o]?l.push(b.sheet[o].v):l.push(null)}}return h}}function m(a){function b(b,c){for(var e=0;e<d.args.length;e++)if(d.args[e]===b)try{var f=c(d.args[e-1].calc(),d.args[e+1].calc());d.args.splice(e-1,3,new h(f)),e--}catch(g){throw Error(a.name+": evaluating "+a.cell.f)}}function c(){for(var a=d.args.length;a--;)if("-"===d.args[a]){var b=-d.args[a+1].calc();"string"!=typeof d.args[a-1]&&a>0?(d.args.splice(a,1,"+"),d.args.splice(a+1,1,new h(b))):d.args.splice(a,2,new h(b))}}var d=this;d.args=[],d.name="Expression",d.calc=function(){return c(),b("^",function(a,b){return Math.pow(+a,+b)}),b("*",function(a,b){return+a*+b}),b("/",function(a,b){return+a/+b}),b("+",function(a,b){return+a+ +b}),b("&",function(a,b){return""+a+b}),b("<",function(a,b){return b>a}),b(">",function(a,b){return a>b}),b(">=",function(a,b){return a>=b}),b("<=",function(a,b){return b>=a}),b("<>",function(a,b){return a!=b}),b("=",function(a,b){return a==b}),1==d.args.length?d.args[0].calc():void 0};var e;d.push=function(b){if(b){var c;c=isNaN(b)?"string"==typeof b&&b.trim().replace(/\$/g,"").match(/^[A-Z]+[0-9]+:[A-Z]+[0-9]+$/)?new l(b.trim().replace(/\$/g,""),a):"string"==typeof b&&b.trim().replace(/\$/g,"").match(/^[A-Z]+[0-9]+$/)?new i(b.trim().replace(/\$/g,""),a):b:new h(+b),"="===c&&(">"==e||"<"==e)||"<"==e&&">"===c?d.args[d.args.length-1]+=c:d.args.push(c),e=c}}}function n(a){a.status="working";for(var b,c=a.cell.f,d=b=new m(a),e="",f=!1,i=!1,j=[{exp:d}],k=0;k<c.length;k++)if('"'==c[k])f?(d.push(new h(e)),f=!1,i=!0):f=!0,e="";else if(f)e+=c[k];else if("("==c[k]){var l,n=q[e.trim()];if(n)n=new g(n,a);else if(e)throw new Error(a.name+": Function "+e+" not found");l=new m(a),j.push({exp:l,special:n}),d=l,e=""}else if(s[c[k]])i||d.push(e),i=!1,d.push(c[k]),e="";else if(","===c[k]&&j[j.length-1].special)j[j.length-1].exp.push(e),j[j.length-1].special.push(j[j.length-1].exp),j[j.length-1].exp=d=new m(a),e="";else if(")"==c[k]){var o,p=j.pop();d=p.exp,d.push(e),o=d,e="",d=j[j.length-1].exp,p.special?(p.special.push(o),d.push(p.special)):d.push(o)}else e+=c[k];b.push(e);try{a.cell.v=b.calc()}catch(r){if("#N/A"!=r.message)throw r;a.cell.v=42,a.cell.t="e",a.cell.w=r.message}finally{a.status="done"}}function o(a){var b={},c=[];for(var d in a.Sheets){var e=a.Sheets[d];for(var f in e)if(e[f].f){var g=b[f]={formula_ref:b,wb:a,sheet:e,cell:e[f],name:f,status:"new"};c.push(g)}}return c}function p(a,b,c){var d=a[b];c.noConflict=function(){return a[b]=d,c},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports[b]=c):a[b]=c,"function"==typeof define&&define.amd&&define(b,[],function(){return c})}var q={FLOOR:Math.floor,"_xlfn.FLOOR.MATH":Math.floor,ABS:Math.abs,SQRT:Math.sqrt,VLOOKUP:f,MAX:d,SUM:c,MIN:e,CONCATENATE:b,IF:a},r=function(a){for(var b=o(a),c=b.length-1;c>=0;c--)n(b[c])};r.set_fx=function(a,b){q[a]=b},r.col_str_2_int=j,r.int_2_col_str=k;var s={"*":"multiply","+":"plus","-":"minus","/":"divide","^":"power","&":"concat","<":"lt",">":"gt","=":"eq"};p(this,"XLSX_CALC",r)}).call(this);