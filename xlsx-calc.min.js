/*! xlsx-calc 2015-10-22 */
"use strict";(function(){function a(){for(var a="",b=0;b<arguments.length;b++)a+=arguments[b];return a}function b(){for(var a=0,b=arguments.length;b--;){var c=arguments[b];if(Array.isArray(c))for(var d=c,e=d.length;e--;)for(var f=d[e].length;f--;)a+=d[e][f];else a+=c}return a}function c(){for(var a=null,b=arguments.length;b--;){var c=arguments[b];if(Array.isArray(c))for(var d=c,e=d.length;e--;)a=null==a||a<d[e]?d[e]:a;else isNaN(c)?console.log("WTF??",c):a=null==a||c>a?c:a}return a}function d(){for(var a=null,b=arguments.length;b--;){var c=arguments[b];if(Array.isArray(c))for(var d=c,e=d.length;e--;)a=null==a||a>d[e]?d[e]:a;else isNaN(c)?console.log("WTF??",c):a=null==a||a>c?c:a}return a}function e(a,b,c){for(var d=0;d<b.length;d++)if(b[d][0]==a)return b[d][c-1];throw Error("#N/A")}function f(a,b){var c=this;c.name="UserFn",c.args=[];var d=!1;c.calc=function(){return a.apply(c,c.args)},c.push=function(a){if(a){var e;if(isNaN(a)){if(a.calc)e=a.calc();else if(a.trim().match(/^[A-Z]+[0-9]+:[A-Z]+[0-9]+$/))e=new k(a.trim(),b).values();else if(a.trim().match(/^[A-Z]+[0-9]+$/))e=new h(a.trim(),b).calc();else if("-"===a)return void(d=!0)}else e=+a;d&&(e=-e),c.args.push(e)}}}function g(a){this.calc=function(){return a}}function h(a,b){this.calc=function(){var c=b.sheet[a];if(!c)throw Error("Cell "+a+" not found.");var d=b.formula_ref[a];if(!d)return b.sheet[a].v;if("new"===d.status)return m(d),b.sheet[a].v;if("working"===d.status)throw new Error("Circular ref");return"done"===d.status?b.sheet[a].v:void 0}}function i(a){for(var b=0,c=a.length;c--;)b+=Math.pow(26,a.length-c-1)*(a.charCodeAt(c)-64);return b-1}function j(a){for(var b="";a>25;)a-=26,b+="A";return b+String.fromCharCode(a+65)}function k(a,b){this.values=function(){for(var c=a.split(":"),d=parseInt(c[0].replace(/^[A-Z]+/,""),10),e=parseInt(c[1].replace(/^[A-Z]+/,""),10),f=i(c[0].replace(/[0-9]$/,"")),g=i(c[1].replace(/[0-9]$/,"")),h=[],k=d;e>=k;k++){var l=[];h.push(l);for(var n=f;g>=n;n++){var o=j(n)+k;if(b.formula_ref[o]){if("new"===b.formula_ref[o].status)m(b.formula_ref[o]);else if("working"===b.formula_ref[o].status)throw new Error("Circular ref");l.push(b.sheet[o].v)}else b.sheet[o]?l.push(b.sheet[o].v):l.push(null)}}return h}}function l(a){function b(a,b){for(var c=0;c<d.args.length;c++)if(d.args[c]===a){var e=b(d.args[c-1].calc(),d.args[c+1].calc());d.args.splice(c-1,3,new g(e)),c--}}function c(){for(var a=d.args.length;a--;)if("-"===d.args[a]){var b=-d.args[a+1].calc();"string"!=typeof d.args[a-1]&&a>0?(d.args.splice(a,1,"+"),d.args.splice(a+1,1,new g(b))):d.args.splice(a,2,new g(b))}}var d=this;d.args=[],d.name="Expression",d.calc=function(){return c(),b("^",function(a,b){return Math.pow(a,b)}),b("*",function(a,b){return a*b}),b("/",function(a,b){return a/b}),b("+",function(a,b){return a+b}),b("&",function(a,b){return""+a+b}),1==d.args.length?d.args[0].calc():void 0},d.push=function(b){b&&(isNaN(b)?"string"==typeof b&&b.trim().match(/^[A-Z]+[0-9]+$/)?d.args.push(new h(b.trim(),a)):d.args.push(b):d.args.push(new g(+b)))}}function m(a){a.status="working";for(var b,c=a.cell.f,d=b=new l(a),e="",h=!1,i=!1,j=[{exp:d}],k=0;k<c.length;k++)if('"'==c[k])h?(d.push(new g(e)),h=!1,i=!0):h=!0,e="";else if(h)e+=c[k];else if("("==c[k]){var m,n=p[e];if(n)m=new f(n,a),j.push({exp:m,special:!0}),d=m;else{if(e)throw new Error("Function "+e+" not found");m=new l(a),j.push({exp:m}),d=m}e=""}else if(r[c[k]])i||d.push(e),i=!1,d.push(c[k]),e="";else if(","===c[k]&&j[j.length-1].special)j[j.length-1].exp.push(e),e="";else if(")"==c[k]){var o,q=j.pop();d=q.exp,d.push(e),o=d,e="",d=j[j.length-1].exp,d.push(o)}else e+=c[k];b.push(e);try{a.cell.v=b.calc()}catch(s){if("#N/A"!=s.message)throw s;a.cell.v=42,a.cell.t="e",a.cell.w=s.message}finally{a.status="done"}}function n(a){var b={},c=[];for(var d in a.Sheets){var e=a.Sheets[d];for(var f in e)if(e[f].f){var g=b[f]={formula_ref:b,wb:a,sheet:e,cell:e[f],name:f,status:"new"};c.push(g)}}return c}function o(a,b,c){var d=a[b];c.noConflict=function(){return a[b]=d,c},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports[b]=c):a[b]=c,"function"==typeof define&&define.amd&&define(b,[],function(){return c})}var p={FLOOR:Math.floor,"_xlfn.FLOOR.MATH":Math.floor,ABS:Math.abs,SQRT:Math.sqrt,VLOOKUP:e,MAX:c,SUM:b,MIN:d,CONCATENATE:a},q=function(a){for(var b=n(a),c=b.length-1;c>=0;c--)m(b[c])};q.set_function=function(a,b){p[a]=b};var r={"*":"multiply","+":"plus","-":"minus","/":"divide","^":"power","&":"concat"};o(this,"XLSX_CALC",q)}).call(this);